# Sampling Conformational Diversity to Predict Relative Protein-Ligand Binding Affinities Induced by Mutations in Few-Shot Learning

Our research investigates the resistance of ABL kinase and evaluates mutation-induced changes in binding free energy through data augmentation via subsampling with AlphaFold2 and deep learnings. 
To enhance feature representation, we developed an STGNet model, which utilizes Siamese networks to capture distinct structural features: ligand graphs, protein contact maps, and protein-ligand interaction graphs.

## The construction of the augmented pairwise dataset

Conformation ensembles are generated by subsampling AF2 for 31 ABL kinase mutants and wild-type. AutoDock Vina is used to dock each protein conformation with six TKI molecules, thereby obtaining docking score values for all mutant and wild-type conformations. The following figure illustrates in detail the process of constructing paired datasets for data augmentation. The selection of conformational data includes the top5, top50, and top100.

![dataset Image](https://github.com/AIMedDrug/STGNet/blob/main/notebook/top5/augmentedPairwiseDataset.png?raw=true)

## The structure representation of multimodal fusion deep learning model

The following is the architecture of the STGNet model. The reference data and the AF2-generated data are processed by the Siamese network to capture the feature difference. Protein contact maps and ligand graphs are processed by MPNN, and protein-ligand interaction graphs are processed by GIGN.

![model](https://github.com/AIMedDrug/STGNet/blob/main/notebook/top5/STGNet_model.png?raw=true)

## Structure and graph-aware Siamese network (STGNet) model protocol 

The steps required for STGNet are as follows:  (1) Build the augmented pairwise dataset. (2) Generate molecular maps, protein contact maps, and protein-ligand interaction maps for paired data; and split the data into training, validation, and test sets. (3) Train the model using Siamese networks for three graph-based molecular representations.

Be aware: STGNet also can be used in other pairwise learning task.

We provide scripts for data processing and model training. If you are interested in STGNet, you can use the .py and .ipynb files.

We took top5 samples in data augmentation as an example, uploaded the source code to GitHub, and can also use Google Colab for testing.

**1 github**

github address: https://github.com/AIMedDrug/STGNet.git

**2 Google colab's .ipynb file address for testing**

(1) Direct Testing model

STGNet_test: https://colab.research.google.com/github/AIMedDrug/STGNet/blob/main/notebook/top5/STGNet_test.ipynb

(2) Gain predicted values for different TKIs

STGNet_getPredValue: https://colab.research.google.com/github/AIMedDrug/STGNet/blob/main/notebook/top5/STGNet_getPredValue.ipynb

(3) Evaluation: Obtain RMSE, MAE, Pearson coefficients, and Spearman coefficients for different TKIs

STGNet_pltMetrics: https://colab.research.google.com/github/AIMedDrug/STGNet/blob/main/notebook/top5/STGNet_pltMetrics.ipynb

## Additional Information for Self-Training an Ab Initio Model

We have provided the relevant code in the STGNet/script directory on GitHub:

(1) Conduct docking and Obtain the relative docking score
python docking.py

(2.0) Construct paired datasets for data augmentation
python formTupleData.py

(2.1) Build data file 1-dat file
python createTupleInterData.py

(2.2) Build feature file 2-pt file
python createFeatureTupleInterData.py

(3) Train model
python trainVal.py

(4) Generate predicted values
python getPredValue.py


We upload other data files to the Zenodo (https://zenodo.org/uploads/14607966), including the docked structures of the ligand, and the generated structures of the mutations from subsampled AF2.



